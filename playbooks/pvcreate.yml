---
- hosts: gluster_servers
  remote_user: root
  gather_facts: no

  tasks:
  # Remove the filesystem signature. sometimes pvcreate fails if signature is
  # present.
  - name: Clean up filesystem signature
    command: wipefs -a {{ item }}
    with_items: "{{ bricks | default([]) }}"
    when: wipefs is defined and wipefs == 'yes' and item is defined
    ignore_errors: yes

  # Create pv on all the disks
  - name: Create Physical Volume
    pv: action=create disk={{ item }}
        force="y"
        uuid="7px2Wj-ki7V-aSF6-79jh-ORum-lEd8-w66h5d"
        zero="n"
          # options="--dataalignment {{ dalign }}k"

    with_items: "{{ bricks }}"
    register: result
    failed_when: "result.rc != 0 and 'Physical Volume Exists' not in result.msg"
