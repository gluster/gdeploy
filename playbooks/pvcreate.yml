---
- hosts: gluster_servers
  remote_user: root
  gather_facts: no

  tasks:
  # Remove the filesystem signature. sometimes pvcreate fails if signature is
  # present.
  - name: Clean up filesystem signature
    command: wipefs -a {{ item }}
    with_items: "{{ bricks | default([]) }}"
    when: wipefs is defined and wipefs == 'yes' and item is defined
    ignore_errors: yes

  # Create pv on all the disks
  - name: Create Physical Volume
    pv: action=create disks={{ item }}
        force="y"
        uuid="450d7098-737f-11e7-8cf7-a6006ad3dba0"
        zero="n"
        metadatasize="10"
        dataalignment="1280"
    with_items:
        - "{{ bricks }}"
    register: result
    failed_when: "result.rc != 0 and 'Physical Volume Exists' not in result.msg"
